<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸš¨ å…ƒç•Œå‰µæƒ³ ç·Šæ€¥è³‡æ–™å‚³é€ç³»çµ± - éš±è—æ¸¬è©¦æ¨¡å¼ V5 (ä¿®å¾©é•·æŒ‰)</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            text-align: center;
            padding: 20px;
            background-color: #e6e6fa; 
            color: #333;
        }
        .container {
            max-width: 700px;
            margin: 0 auto;
            background-color: #ffffff;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #f04747; 
            margin-bottom: 20px;
        }
        /* é¸æ“‡é¡å‹å€å¡Š */
        .type-selector {
            margin-bottom: 25px;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 5px;
        }
        .type-selector label, .type-selector select {
            font-size: 1.1em;
            margin-right: 15px;
        }

        /* æŒ‰éˆ•æ¨£å¼ */
        .button-group button {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.1s;
            font-weight: bold;
            margin: 0 10px;
        }
        #emergency-button {
            background-color: #f04747; /* ç´…è‰² - ç·Šæ€¥ */
            color: white;
        }
        #emergency-button:hover {
            background-color: #c0392b;
        }

        #status {
            margin-top: 30px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1.1em;
            color: #555;
            min-height: 20px;
            background-color: #f9f9f9;
        }

        /* è²æ˜å€å¡Šæ¨£å¼ - ä½œç‚ºé•·æŒ‰è§¸ç™¼å™¨ (ç„¡è¦–è¦ºæç¤º) */
        .declaration {
            text-align: left;
            padding: 20px;
            border: 1px solid #e0b0ff; 
            border-radius: 5px;
            background-color: #fcf8ff;
            margin-top: 30px;
            /* ä¿æŒé è¨­æ¸¸æ¨™ï¼Œä¸æ´©éœ²å¯äº’å‹•æ€§ */
            cursor: default;
        }
        .declaration h4 {
            color: #4b0082; 
        }
        
        /* ç¢ºä¿é•·æŒ‰ç›®æ¨™çš„æ–‡å­—ä¸æœƒè¢«é¸ä¸­ï¼Œé€™æœ‰åŠ©æ–¼åœ¨ç§»å‹•è¨­å‚™ä¸Šç©©å®šé•·æŒ‰ */
        .declaration p {
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }
        
        #trigger-text {
            margin-top: 15px; 
            font-weight: bold; 
            color: #cc0000;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>ğŸš¨ å…ƒç•Œå‰µæƒ³ ç·Šæ€¥è³‡æ–™å‚³é€ç³»çµ± ğŸš¨</h1>

        <div class="type-selector">
            <label for="report-type">é¸æ“‡å ±å‘Šé¡å‹:</label>
            <select id="report-type">
                <option value="FIRE">ç«ç½ (FIRE)</option>
                <option value="MEDICAL">é†«ç™‚ç·Šæ€¥ (MEDICAL)</option>
                <option value="SECURITY">å®‰å…¨å¨è„… (SECURITY)</option>
                <option value="INFRASTRUCTURE">åŸºç¤è¨­æ–½æ•…éšœ (INFRASTRUCTURE)</option>
                <option value="OTHER">å…¶ä»– (OTHER)</option>
            </select>
        </div>
        
        <div class="button-group">
            <button id="emergency-button" onclick="triggerDataTransmission(false, null)">
                ğŸš¨ ç«‹å³ç·Šæ€¥å‚³é€
            </button>
        </div>

        <p id="status">ç­‰å¾…æ“ä½œ...</p>

        <hr style="margin-top: 30px;">

        <div id="test-trigger-area" class="declaration">
            <h3>ğŸ”’ å®‰å…¨è²æ˜èˆ‡è³‡æ–™ç”¨é€”è²æ˜</h3>
            
            <h4>1. è³‡æ–™æ”¶é›†é …ç›®</h4>
            <p>ç•¶æ‚¨é»æ“ŠæŒ‰éˆ•æ™‚ï¼Œæœ¬ç³»çµ±å°‡ç«‹å³ä¸”å–®æ¬¡åœ°æ”¶é›†ä»¥ä¸‹è³‡è¨Šï¼š</p>
            <ul>
                <li><strong>åœ°ç†ä½ç½®è³‡æ–™ (Location):</strong> ç¶“åº¦ã€ç·¯åº¦åŠç²¾ç¢ºåº¦ã€‚ï¼ˆéœ€ç¶“æ‚¨æ˜ç¢ºå…è¨±ï¼‰</li>
                <li><strong>è¨­å‚™è³‡è¨Š (Device):</strong> ç€è¦½å™¨é¡å‹ã€ä½œæ¥­ç³»çµ±å¹³å°ã€è¢å¹•è§£æåº¦ã€CPU æ ¸å¿ƒæ•¸ã€‚</li>
            </ul>

            <h4>2. è³‡æ–™ç”¨é€”èªªæ˜</h4>
            <p>æ‰€æ”¶é›†çš„è³‡æ–™åƒ…ç”¨æ–¼**ç·Šæ€¥æƒ…æ³ä¸‹çš„è³‡æ–™å‚³é€èˆ‡å”èª¿ç›®çš„**ï¼š</p>
            <ul>
                <li><strong>ç·Šæ€¥å®šä½ï¼š</strong> æä¾›æ‚¨çš„ç²¾ç¢ºä½ç½®ï¼Œä»¥åˆ©æ–¼ç·Šæ€¥æ‡‰è®Šå°çµ„è¿…é€Ÿå®šä½ã€‚</li>
                <li><strong>ç’°å¢ƒè©•ä¼°ï¼š</strong> å”åŠ©åˆ¤æ–·æ•¸æ“šçš„ä¾†æºç’°å¢ƒï¼Œå„ªåŒ–æ¥æ”¶ç«¯çš„è™•ç†æµç¨‹ã€‚</li>
            </ul>

            <h4>3. å®‰å…¨èˆ‡éš±ç§ä¿è­·</h4>
            <ul>
                <li><strong>å–®æ¬¡å‚³è¼¸ï¼š</strong> åƒ…åœ¨æ‚¨æ¯æ¬¡é»æ“ŠæŒ‰éˆ•æ™‚åŸ·è¡Œå–®æ¬¡ã€éæŒçºŒæ€§çš„å‚³è¼¸ã€‚</li>
                <li><strong>ç›®æ¨™é™åˆ¶ï¼š</strong> è³‡æ–™åƒ…å‚³é€è‡³ä¸€å€‹é å…ˆè¨­å®šçš„ **Discord Webhook URL**ã€‚</li>
                <li><strong>ç„¡ç¬¬ä¸‰æ–¹åˆ†äº«ï¼š</strong> é™¤éæ³•å¾‹è¦æ±‚æˆ–æ¶‰åŠç”Ÿå‘½å®‰å…¨ï¼Œå¦å‰‡ä¸æœƒåˆ†äº«çµ¦ä»»ä½•ç¬¬ä¸‰æ–¹éç·Šæ€¥æœå‹™æ©Ÿæ§‹ã€‚</li>
            </ul>
            
            <p id="trigger-text">
                âš ï¸ é€éä½¿ç”¨æœ¬ç³»çµ±ï¼Œæ‚¨å³è¡¨ç¤ºç†è§£ä¸¦åŒæ„ä¸Šè¿°è³‡æ–™çš„æ”¶é›†èˆ‡ç·Šæ€¥ç”¨é€”ã€‚
            </p>
        </div>
        </div>

    <script>
        // *******************************************************************
        // *** ğŸ”´ é—œéµè¨­å®šï¼šDiscord Webhook URL ğŸ”´ ***
        const DISCORD_WEBHOOK_URL = "https://discord.com/api/webhooks/1354447077265903748/BKMp3EqdwM7zES2L-Fo1_IPEAT5atKV2Svggu31kyoaiAUj85bLPIdLq2CXyeTnYkRgH"; 
        // *******************************************************************
        
        const statusElement = document.getElementById('status');
        const testTriggerArea = document.getElementById('test-trigger-area'); // æ•´å€‹è²æ˜å€å¡Š
        
        const HOLD_DURATION = 3000; // 3ç§’
        let holdTimer = null;
        let isHolding = false;
        const TEST_REPORT_TYPE = 'TEST_REPORT'; 

        // --- 1. éš±è—é•·æŒ‰æ¸¬è©¦æ¨¡å¼è§¸ç™¼é‚è¼¯ ---

        function startHold(event) {
            // æª¢æŸ¥æ˜¯å¦æ˜¯ä¸»è¦æŒ‰éˆ• (å·¦éµæˆ–è§¸æ§)
            if (event.button !== 0 && event.type !== 'touchstart') return; 
            if (isHolding) return; 

            isHolding = true;

            // ç¢ºä¿è§¸æ§æ™‚ä¸é¡¯ç¤ºä¸Šä¸‹æ–‡é¸å–®ï¼ˆä¿®å¾©æŒ‰ä¸äº†çš„ä¸»è¦æ­¥é©Ÿï¼‰
            if (event.type === 'touchstart') {
                 event.preventDefault(); 
            }
            
            // â›” ç„¡è¦–è¦ºå›é¥‹ï¼Œç„¡ç‹€æ…‹æç¤º â›”
            
            holdTimer = setTimeout(() => {
                // 3ç§’æŒ‰ä½æˆåŠŸï¼Œå•Ÿå‹•æ¸¬è©¦å‚³è¼¸
                statusElement.innerHTML = "ğŸ¤« éš±è—æŒ‡ä»¤å·²è§¸ç™¼ï¼šæ­£åœ¨å•Ÿå‹•æ¸¬è©¦å‚³é€... (é¡å‹: ç³»çµ±æ¸¬è©¦)";
                triggerDataTransmission(true, TEST_REPORT_TYPE); 
                holdTimer = null; // Mark as successfully triggered
                endHold(); // Cleanup
            }, HOLD_DURATION);
        }

        function endHold() {
            if (!isHolding) return;
            
            clearTimeout(holdTimer);
            
            // å¦‚æœå®šæ™‚å™¨é‚„æ²’è§¸ç™¼ï¼Œä¿æŒç‹€æ…‹æ¬„éœé»˜
            
            holdTimer = null;
            isHolding = false;
        }

        // ç¶å®šäº‹ä»¶ç›£è½å™¨åˆ°æ•´å€‹è²æ˜å€å¡Š
        testTriggerArea.addEventListener('mousedown', startHold);
        testTriggerArea.addEventListener('mouseup', endHold);
        testTriggerArea.addEventListener('mouseleave', endHold);
        testTriggerArea.addEventListener('touchstart', startHold); 
        testTriggerArea.addEventListener('touchend', endHold);


        // --- 2. è³‡æ–™æ”¶é›†èˆ‡å‚³è¼¸æ ¸å¿ƒå‡½æ•¸ (ä¿æŒä¸è®Š) ---

        function getDeviceInfo() {
            return {
                platform: navigator.platform || 'N/A',
                os_browser: navigator.userAgent || 'N/A',
                screen_size: `${window.screen.width}x${window.screen.height}`,
                cores: navigator.hardwareConcurrency || 'N/A'
            };
        }

        function triggerDataTransmission(isTest, forcedType = null) {
            const reportType = isTest ? forcedType : document.getElementById('report-type').value;
            
            if (!reportType) {
                statusElement.innerHTML = "âŒ **éŒ¯èª¤:** ç„¡æ³•ç¢ºå®šå ±å‘Šé¡å‹ã€‚";
                return;
            }

            if (!isTest) {
                statusElement.innerHTML = `ğŸ”„ æ­£åœ¨ç²å–ä½ç½®èˆ‡è¨­å‚™è³‡è¨Š... (ç·Šæ€¥å‚³è¼¸) é¡å‹: ${reportType}`;
            }
            
            const deviceInfo = getDeviceInfo();

            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => sendDataWrapper(position, deviceInfo, reportType, isTest), 
                    (error) => handleError(error, deviceInfo, reportType, isTest), 
                    {
                        enableHighAccuracy: true,
                        timeout: 7000, 
                        maximumAge: 0
                    }
                );
            } else {
                statusElement.innerHTML = "âš ï¸ ç€è¦½å™¨ä¸æ”¯æ´å®šä½åŠŸèƒ½ã€‚<br>æ­£åœ¨å‚³é€å·²æ”¶é›†çš„è¨­å‚™è³‡è¨Š...";
                sendToDiscord(null, null, deviceInfo, "âš ï¸ ç€è¦½å™¨å®šä½æœå‹™ä¸å¯ç”¨", reportType, isTest);
            }
        }

        function sendDataWrapper(position, deviceInfo, reportType, isTest) {
            const latitude = position.coords.latitude;
            const longitude = position.coords.longitude;
            
            statusElement.innerHTML = `âœ… å·²ç²å–æ‰€æœ‰è³‡æ–™ï¼šç·¯åº¦: ${latitude.toFixed(6)}, ç¶“åº¦: ${longitude.toFixed(6)}<br>æ­£åœ¨å‚³é€è‡³ Discord...`;

            sendToDiscord(latitude, longitude, deviceInfo, "âœ… æˆåŠŸå–å¾—ä½ç½®", reportType, isTest); 
        }

        function handleError(error, deviceInfo, reportType, isTest) {
            let errorMessage = "";
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    errorMessage = "ç”¨æˆ¶æ‹’çµ•äº†åœ°ç†ä½ç½®è«‹æ±‚ã€‚";
                    break;
                case error.POSITION_UNAVAILABLE:
                    errorMessage = "ä½ç½®è³‡è¨Šç„¡æ³•å–å¾— (ç¶²è·¯æˆ–è¨Šè™Ÿå•é¡Œ)ã€‚";
                    break;
                case error.TIMEOUT:
                    errorMessage = "è«‹æ±‚è¶…æ™‚ã€‚";
                    break;
                default:
                    errorMessage = "ç™¼ç”ŸæœªçŸ¥éŒ¯èª¤ã€‚";
                    break;
            }
            console.error("å®šä½å¤±æ•—:", errorMessage);
            statusElement.innerHTML = `âš ï¸ å®šä½å¤±æ•—: ${errorMessage} <br>æ­£åœ¨å‚³é€å·²æ”¶é›†çš„è¨­å‚™è³‡è¨Š...`;
            sendToDiscord(null, null, deviceInfo, `âš ï¸ å®šä½éŒ¯èª¤: ${errorMessage}`, reportType, isTest);
        }

        function sendToDiscord(latitude, longitude, deviceInfo, statusText, reportType, isTest) {
            // æ³¨æ„: ç‚ºäº†å®‰å…¨èˆ‡ç¬¦åˆè¦ç¯„ï¼Œåœ°åœ–é€£çµçš„ç¶²å€éƒ¨åˆ†è¢«ä¿®æ”¹ç‚ºç¤ºä¾‹ã€‚
            const mapLink = (latitude && longitude) 
                ? `http://googleusercontent.com/maps.google.com/9${latitude},${longitude}` 
                : "https://developers.google.com/maps/documentation/javascript/geolocation"; 

            const isLocationFound = latitude && longitude;
            let color;
            
            if (isTest) {
                color = 16763904; 
            } else {
                color = isLocationFound ? 15746880 : 5592405; 
            }

            const titlePrefix = isTest ? "[ğŸ§ª TEST MODE] " : "ğŸš¨ [EMERGENCY] ";
            const content = `${titlePrefix} **å ±å‘Šé¡å‹: ${reportType}**`;

            const locationFields = isLocationFound ? [
                {
                    name: "ğŸ“ ç·¯åº¦ (Latitude)",
                    value: latitude.toFixed(6).toString(),
                    inline: true
                },
                {
                    name: "ğŸ“ ç¶“åº¦ (Longitude)",
                    value: longitude.toFixed(6).toString(),
                    inline: true
                },
                {
                    name: "ğŸ—ºï¸ åœ°åœ–é€£çµ",
                    value: `[é»æ“ŠæŸ¥çœ‹ä½ç½®](${mapLink})`,
                    inline: false
                }
            ] : [
                {
                    name: "ğŸš¨ ä½ç½®ç‹€æ…‹",
                    value: statusText,
                    inline: false
                }
            ];

            const payload = {
                content: content,
                embeds: [
                    {
                        title: `${titlePrefix} ${statusText} - å ±å‘Šé¡å‹: ${reportType}`,
                        color: color,
                        url: mapLink,
                        fields: [
                            ...locationFields,
                            
                            {
                                name: "--- ğŸ’» è¨­å‚™è³‡è¨Š ---",
                                value: " ",
                                inline: false
                            },
                            {
                                name: "ğŸ–¥ï¸ ä½œæ¥­ç³»çµ±/å¹³å°",
                                value: deviceInfo.platform,
                                inline: true
                            },
                            {
                                name: "ğŸ“ è¢å¹•è§£æåº¦",
                                value: deviceInfo.screen_size,
                                inline: true
                            },
                            {
                                name: "âš™ï¸ CPU æ ¸å¿ƒæ•¸",
                                value: deviceInfo.cores.toString(),
                                inline: true
                            },
                            {
                                name: "ğŸ†” User Agent (ç€è¦½å™¨/OS è³‡è¨Š)",
                                value: deviceInfo.os_browser,
                                inline: false
                            },
                        ],
                        footer: {
                            text: "ç·Šæ€¥è³‡æ–™å‚³é€æ™‚é–“"
                        },
                        timestamp: new Date().toISOString()
                    }
                ]
            };

            fetch(DISCORD_WEBHOOK_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(payload),
            })
            .then(response => {
                if (response.ok) {
                    statusElement.innerHTML = 'âœ… **å‚³é€å®Œæˆï¼** ç·Šæ€¥è³‡æ–™å·²æˆåŠŸç™¼é€åˆ° Discordï¼';
                } else {
                    statusElement.innerHTML = `âŒ **å‚³é€å¤±æ•—ï¼** (${response.status}) è«‹æª¢æŸ¥ Webhook URL æ˜¯å¦æ­£ç¢ºæˆ–å¤±æ•ˆã€‚`;
                }
            })
            .catch(error => {
                console.error('ç¶²è·¯éŒ¯èª¤:', error);
                statusElement.innerHTML = 'âŒ ç™¼ç”Ÿç¶²è·¯éŒ¯èª¤ï¼Œç„¡æ³•å‚³é€è³‡æ–™ã€‚';
            });
        }
    </script>

</body>
</html>
